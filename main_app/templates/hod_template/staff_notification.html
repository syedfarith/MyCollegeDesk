{% extends 'main_app/base.html' %}
{% load static %}
{% block page_title %}{{page_title}}{% endblock page_title %}

{% block content %}

<section class="content">
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">{{page_title}}</h3>
                    </div>
                    <!-- /.card-header -->
                    <div class="card-body">
                        <div class="staff-container">
                            {% for staff in allStaff %}
                            <div class="staff-card">
                                <div class="staff-avatar">
                                    {% if staff.profile_pic %}
                                    <img src="{{ staff.profile_pic }}" alt="Profile Picture">
                                    {% else %}
                                    <div class="no-image">No Image</div>
                                    {% endif %}
                                </div>
                                <div class="staff-info">
                                    <h3>{{ staff.first_name }} {{ staff.last_name }}</h3>
                                    <p>Email: {{ staff.email }}</p>
                                    <p>Gender: {{ staff.gender }}</p>
                                    <p>Course: {{ staff.staff.course.name }}</p>
                                </div>
                                <div class="staff-action">
                                    <button class="btn btn-primary show_notification" value="{{ staff.id }}" data-toggle="modal" data-target="#myModal">Send Message</button>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
<style>
    .staff-container {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-around;
    gap: 20px;
    padding: 20px;
}

.staff-card {
    background-color: #f9f9fa;
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    width: calc(33.333% - 20px); /* Three cards per row with gap */
    overflow: hidden;
    transition: transform 0.3s ease;
}

.staff-card:hover {
    transform: translateY(-5px);
}

.staff-avatar {
    width: 100%;
    height: 150px;
    background-color: #eee;
    display: flex;
    justify-content: center;
    align-items: center;
}

.staff-avatar img, .staff-avatar .no-image {
    max-width: 100%;
    max-height: 100%;
}

.staff-info {
    padding: 15px;
    color: #333;
}

.staff-info h3 {
    margin-top: 0;
}

.staff-action {
    padding: 10px 15px;
    background-color: #007bff;
    text-align: center;
}

.staff-action .btn {
    margin: 0; /* Adjust based on your design */
}

@media (max-width: 768px) {
    .staff-card {
        width: calc(50% - 20px); /* Two cards per row on smaller screens */
    }
}

@media (max-width: 480px) {
    .staff-card {
        width: 100%; /* Full width on very small screens */
    }
}

</style>                        
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<div class = "modal fade" id = "myModal" tabindex = "-1" role = "dialog" 
   aria-labelledby = "myModalLabel" aria-hidden = "true">
   
   <div class = "modal-dialog">
      <div class = "modal-content">
         
         <div class = "modal-header">Send Message
            <button type = "button" class = "close" data-dismiss = "modal" aria-hidden = "true">
                  &times;
            </button>
            
           
         </div>
         
         <div class = "modal-body">
            <div class="form-group">
                <input type="text" id="message" class='form-control'>
                <input type="hidden"  id="staff_id" class='form-control'>
            </div>
         </div>
         
         <div class = "modal-footer">
            <button type = "button" class = "btn btn-danger" data-dismiss = "modal">
               Close
            </button>
            
            <button type = "button" id='send' class = "btn btn-success send_notification"><i style="color: #eee;" class="fa-regular fa-paper-plane-top"></i>
               Send Message
            </button>
         </div>
         
      </div><!-- /.modal-content -->
   </div><!-- /.modal-dialog -->
  
</div><!-- /.modal -->
{% endblock content %}
{% block custom_js %}
  <script>
      $(".show_notification").click(function(){
          $("#staff_id").val($(this).val())
      })
      $(".send_notification").click(function(){
          var id = $("#staff_id").val()
          var message = $("#message").val()
          sendNotification(id,message);
      })
    function sendNotification(id,message){
        $.ajax({
            url: "{% url 'send_staff_notification' %}",
            type: 'POST',
            data: {
                id: id,
                message:message
            }
        }).done(function (response) {
           
          if (response == 'True'){
            alert("Notification Sent");
            location.reload();
          }else{
            alert("Notification could not be saved. Please try again.");
          }
           
        }).fail(function (response) {
            alert("Error in saving token")
        })

    }

  </script>
{% endblock custom_js %}